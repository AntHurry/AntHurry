<html layout:decorate="~{usr/layout/layout.html}">

<head>
    <title>채팅 목록</title>
</head>

<body>
<header layout:fragment="header" class="sticky top-0 z-50">

    <div class="navbar max-w-2xl mx-auto bg-base-100">
        <div class="navbar-start">
            <div>
                <a href="#" tabindex="0" class="btn btn-ghost btn-circle" onclick="history.back()">
                    <i class="fa-solid fa-angle-left"></i>
                </a>
            </div>
        </div>
        <div class="navbar-center">
            <a class="font-black">나의 채팅 목록</a>
        </div>
        <div class="navbar-end">
            <button class="btn btn-ghost btn-circle">
                <!-- ellipsis 클릭 시 각각의 채팅방 체크하여 채팅방 나가기, 거래 시작/완료 등 선택할 수 있도록 할 예정 -->
                <i class="fa-solid fa-ellipsis-vertical"></i>
            </button>
        </div>
    </div>

</header>

<main layout:fragment="main" class="flex-grow flex flex-col items-center justify-center w-screen p-4">
    <div th:if="${#lists.isEmpty(latestMessages)}" class="text-lg text-gray-400 pt-12">
        채팅 중인 대화방이 없습니다.<i class="fa-regular fa-face-sad-tear ml-2"></i>
    </div>
    <div th:if="${!#lists.isEmpty(latestMessages)}">
        <button th:each="message : ${latestMessages}"
                class="hover:bg-gray-50 active:bg-gray-100 border-2 border-solid border-gray-100 rounded-lg w-screen px-8 py-6 mb-6 flex justify-between items-center">
            <div>
                <div class="mb-2 text-start">
                    <span style="padding: 0;" th:if="${@rq.getMember() == message.getRoomId.members.get(0)}"
                          th:text="|${message.getRoomId.members.get(1)} 님|"
                          class="font-black text-lg"></span>
                    <span style="padding: 0;"
                          th:if="${@rq.getMember() == message.getRoomId.members.get(1)}"
                          th:text="|${message.getRoomId.members.get(0)} 님|"
                          class="font-black text-lg"></span>
                    <span th:if="${#temporals.format(#dates.createNow(), 'MM-dd').equals(#temporals.format(message.createdAt, 'MM-dd'))}"
                          th:text="${#temporals.format(message.createdAt, 'HH:mm')}" class="ml-2 text-gray-400"></span>
                    <span th:if="${!(#temporals.format(#dates.createNow(), 'MM-dd').equals(#temporals.format(message.createdAt, 'MM-dd')))}"
                          th:text="${#temporals.format(message.createdAt, 'MM월 dd일')}"
                          class="ml-2 text-gray-400"></span>
                </div>

                <p th:if="${message.message != null}" th:text="${message.message.content}"
                   class="text-lg text-start"></p>
                <p th:if="${message.fileMessage != null}" class="text-lg text-start">파일을 다운로드할 수 있습니다.</p>
            </div>
            <div th:if="${message.message != null && @rq.getMember() != message.message.getSender() && message.message.isNotRead()}"
                 class="bg-[#ff626f] w-16 text-white font-semibold rounded-xl">new
            </div>
            <div th:if="${message.fileMessage != null && @rq.getMember() != message.fileMessage.getSender() && message.fileMessage.isNotRead()}"
                 class="bg-[#ff626f] w-16 text-white font-semibold rounded-xl">new
            </div>
        </button>
    </div>
</main>

</body>

</html>