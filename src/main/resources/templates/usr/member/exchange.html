<html layout:decorate="~{usr/layout/layout.html}">

<head>
    <title>코인 환전</title>
</head>

<body>
<header layout:fragment="header" class="sticky top-0 z-50">

    <div class="navbar max-w-2xl mx-auto bg-base-100">
        <div class="navbar-start">
            <div>
                <a href="#" tabindex="0" class="btn btn-ghost btn-circle" onclick="history.back()">
                    <i class="fa-solid fa-angle-left"></i>
                </a>
            </div>
        </div>
        <div class="navbar-center">
            <a class="font-black">코인 환전</a>
        </div>
        <div class="navbar-end">
            <button class="btn btn-ghost btn-circle">
                <i class="fa-solid fa-ellipsis-vertical"></i>
            </button>
        </div>
    </div>

</header>

<main layout:fragment="main" class="flex-grow flex items-center justify-center">
    <script src="https://js.tosspayments.com/v1"></script>
    <div class="flex flex-col max-w-2xl mx-auto w-11/12 border-t-4 border-pink-300">
        <div class="card shadow-xl">
            <div class="card-body">
                <h2 class="card-title">코인 환전</h2>
                <div class="mt-4 mb-2 flex flex-col gap-2">
                    <div class="mt-3 flex justify">
                        <span class="text-base font-black" th:text="${member.nickname} + '님이 현재 가지고 있는 코인 | '"></span>
                        <span class="text-base pl-2 pr-1" th:text="${member.coin}"></span>
                        <img class="w-6 h-6" src="https://cdn-icons-png.flaticon.com/128/1490/1490853.png" alt="text">
                    </div>
                    <div>
                        <i class="fa-solid fa-coins"></i>
                        환전할 금액을 입력해주세요. (1000원 = 1000coin)
                    </div>
                    <input type="text" id="money" class="form-input border-2 border-black" name="money" placeholder="0"
                           onkeyup="formatCurrency(this)"/>
                </div>
                <button onclick="getPriceAndExecutePayment();" class="btn btn-sm btn-primary">환전</button>
            </div>
        </div>
    </div>
    <script th:inline="javascript">

        var userCoin = [[${member.coin}]];

        function formatCurrency(input) {
            var value = input.value;
            value = value.replace(/,/g, "")
            value = parseInt(value.replace(/\B(?=(\d{3})+(?!\d))/g, ""));
            if (value > userCoin) {
                alert("현재 가지고 있는 코인보다 높게 입력했습니다.");
                input.value = userCoin;
                return;
            }
            input.value = value.toLocaleString();
        }
    </script>
</main>

</body>

</html>